\hypertarget{md__r_e_a_d_m_e_autotoc_md1}{}\doxysection{Assignment 1}\label{md__r_e_a_d_m_e_autotoc_md1}
\hypertarget{md__r_e_a_d_m_e_autotoc_md2}{}\doxysection{Brief introduction}\label{md__r_e_a_d_m_e_autotoc_md2}
The aim of this assignment is to design a software behavioural architecture which simulates an autonomous Cluedo game. The robot which is the player wants to find who is the murder, where he killed the victime and which weapon has been used. According to that it goes around to an appartement looking for hints, makes hypotesis about the murder and reasons about these. Once it finds a complete hypotesis (which contains a person, a place and a weapon) it goes to the oracle room and asks if the hypotesis is correct. If hypotesis is not correct robot goes on looking for hints otherwise game finishes. \hypertarget{md__r_e_a_d_m_e_autotoc_md3}{}\doxysection{Software architecture}\label{md__r_e_a_d_m_e_autotoc_md3}
 The {\bfseries{component diagram}} shows how the overall architecture is organized. It is possible to appreciate the modularity of the architecture, I have decided to divide as much as possible each functionality to give the possibility to reuse and adapt the code in a future implementation. Below is presented the behaviour of each node that I have implemented\+:\textbackslash{}
\begin{DoxyItemize}
\item {\bfseries{\mbox{\hyperlink{_f_s_m_8py}{F\+S\+M.\+py}}}} is the core node of the architecture and it manages the sequence of the whole simulation. Inside that node it is possible to appreciate the Finite State Machine.
\item {\bfseries{\mbox{\hyperlink{_random_room_server_8py}{Random\+Room\+Server.\+py}}}} is a simple R\+OS service server which returns a random room between the possible ones in the apartment.
\item {\bfseries{\mbox{\hyperlink{_perceive_hints_8py}{Perceive\+Hints.\+py}}}} is a R\+OS service server with the aim to simulate the fact that when the robot enter in a room it looks around and if there are it perceive hints.
\item {\bfseries{Announcement.\+py}} is a R\+OS service server which simply announce to the Oracle the consisten hypotesis.
\item {\bfseries{\mbox{\hyperlink{_check_correct_8py}{Check\+Correct.\+py}}}} is a R\+OS service server which check if the announced hypotesis is correct.
\item {\bfseries{\mbox{\hyperlink{_moving_8py}{Moving.\+py}}}} is a R\+OS action server which simulates the movement of the robot between the different rooms.
\end{DoxyItemize}

{\bfseries{a\+R\+M\+OR}} is an already implemented \href{https://github.com/EmaroLab/armor}{\texttt{ package}}, in particular it is a R\+OS service server used to manipulate ontologies. {\bfseries{\mbox{\hyperlink{_f_s_m_8py}{F\+S\+M.\+py}}}} is a service client of {\bfseries{a\+R\+M\+OR}}, and through this service it communicates with the ontology. Moreover each node communicate with the R\+OS Parameter Server. I have iserted three file of parameters\+:\textbackslash{}
\begin{DoxyItemize}
\item {\bfseries{Hints.\+yaml}} contains all perceived hints in the simpler simulation.
\item {\bfseries{Hints2.\+yaml}} contains more hints and test the system in a challenging way. The simulation if this file is used take logically more time.
\item {\bfseries{rooms.\+yaml}} contains the rooms of the apartment and thir location
\item {\bfseries{gamesession.\+yaml}} contains the informations about the specific game session in particular the linnk of the ontology and its path in the workspace. The id of the correct hypotesis. The id of the consistent hypotesis that robot want to check. The number of all hints.
\end{DoxyItemize}

In the component diagram the structure of the hierarchical architecture. In particular the core module, the perception modules, the action modules, an the reasoning one are separated. Moreover generally the robot perceive an hints, reason about that hints, decide for the next action and acts. The more relevant difference is the communication protocol used. Generally in a Hierarchical architecture the perception and the action modules communicate with the reason through publisher-\/subscriber communication protocol. There I have decide to use only service-\/client and action communications protocols. Logically these nodes on real robot scenario or in simulation should use pub/sub in order to get information from sensor and send informations to motors or microphones for example. \textbackslash{} To conclude about the component diagram different custom services and messages has been defined\+:\textbackslash{}
\begin{DoxyItemize}
\item {\bfseries{Random\+Room}} has an empty request and returns the parameter name of the room randomly chosen.
\item {\bfseries{Perceived\+Hints}} has an empty request and retrieve firtly an integer which is 0 if nothing has been perceived otherwise 1. Then the perceived hint if any, its hypotesis\textquotesingle{}ID and the question related to the class the hint belog (who for P\+E\+R\+S\+ON or where for P\+L\+A\+CE or what for W\+E\+A\+P\+ON).
\item {\bfseries{Announcement}} has as request the hints to announce. One people, one place and one weapon. The response is simply a boolean.
\item {\bfseries{Chec\+K\+Correct}} has as request the ID of hypotesis that robot want to check if it is true or false. It return True if it is correct otherwise False.
\item {\bfseries{Move}} is a custom action which as goal has the room destination. The actual (x,y) and the goal (x,y). It has as feedbachk the actual position (x,y,theta) when robot moving. The result is a boolean.  The {\bfseries{states diagram}} depicts the three possible states of the robot which has been implemented in {\bfseries{\mbox{\hyperlink{_f_s_m_8py}{F\+S\+M.\+py}}}} through {\bfseries{Smach}}. The first state is {\bfseries{Out\+\_\+\+Room}} which assumes the robot in the Corridor. From this state if there are no consistent hypotesis it pass in {\bfseries{Inside\+\_\+\+Room}} state otherwise in {\bfseries{Oracle\+\_\+\+Room}} state. In {\bfseries{Inside\+\_\+\+Room}} state robot look for one hint then it exit from the room and return to the Corridor. When the robot is in {\bfseries{Oracle\+\_\+\+Room}} state it ask if the current consistent hypotesis is correct if it is the game is finished otherwise it return to {\bfseries{Out\+\_\+\+Room}} seraching from hint. In the diagram each name regarding both states and transitions have been chosen according to the respective one inside the code\textbackslash{}  In the {\bfseries{sequence diagram}} it is possible to see the behaviour of the overall system.\textbackslash{}
\item Robot check for a new consistent hypotesis\+:
\item If there are not\+:
\begin{DoxyEnumerate}
\item look for a random room
\item move to that room
\item look to a new hint
\item return to the corridor
\item if an hint has been perceived it reason about this and if it is belong to a hypotesis not uncorrect it add it to the ontologu√¨y
\item return to check if there is a new consistent hypotesis
\end{DoxyEnumerate}
\item If there are\+:
\begin{DoxyEnumerate}
\item find the ID of that hypotesis
\item move to the Oracle room
\item annonce the hypotesis
\item check if it is correct
\item if it is correct exit to the game
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item if it is not it adds the hypotesis to the I\+N\+C\+O\+R\+R\+E\+CT class
\item it return to the corridor
\item return to check if there is a new consistent hypotesis
\end{DoxyEnumerate}
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md4}{}\doxysection{Installation and running procedures}\label{md__r_e_a_d_m_e_autotoc_md4}
Clone the \href{https://github.com/AliceNardelli/exprob_ass1}{\texttt{ exprob\+\_\+ass1 repository}} and build the workspace. In one terminal run the ros master and then the ontology\+: \begin{quote}
rosrun armor execute it.\+emarolab.\+armor.\+A\+R\+M\+O\+R\+Main\+Service \end{quote}
On another terminal launch the overall sistem\+: \begin{quote}
roslaunch exprob\+\_\+ass1 cluedo\+\_\+game\+\_\+session.\+launch \end{quote}
If you want to use the simulation with more hints goes in the {\bfseries{gamesession.\+yaml}} file and change param {\bfseries{no\+\_\+hints}} with 28 and {\bfseries{correct\+\_\+hypotesis}} with H\+P6. Then goes in the cited launch file and load {\bfseries{Hints2.\+yaml}} instead {\bfseries{Hint.\+yaml}}. In order to see how Finite state Machine evolves in time run\+: \begin{quote}
rosrun smach\+\_\+viewer smach\+\_\+viewer.\+py \end{quote}
\hypertarget{md__r_e_a_d_m_e_autotoc_md5}{}\doxysection{Relevant part to running code}\label{md__r_e_a_d_m_e_autotoc_md5}
As I have already say the orchestration between component done by {\bfseries{\mbox{\hyperlink{_f_s_m_8py}{F\+S\+M.\+py}}}} is certainly the core of the running code. For having a more clear idea about how simulation works run {\bfseries{smach\+\_\+viewer}} is certainly an idea. The two images belows shows how finite state machine looks like when robot is in Out\+\_\+\+Room and Inside\+\_\+\+Room states. Moreover {\bfseries{\mbox{\hyperlink{log_8txt}{log.\+txt}}}} is the logfile of the whole simulation and givev a clear idea about the workflow.  \hypertarget{md__r_e_a_d_m_e_autotoc_md6}{}\doxysection{Working hypothesis and environment}\label{md__r_e_a_d_m_e_autotoc_md6}

\begin{DoxyEnumerate}
\item The model of the apartment is assumed matrix. Rooms are organized in a 3x3 matrix fashioned the figure below. The position of each room is correlated to the cell of the matrix corrersponding to that room. Rows and columns start enumerate from up left corner. For example the Lounge correspond to (1,1) coordinates whereas Library to (2,3). The Corridor is assumed to be at (0,0) posistion whereas the Oracle room at (10,10). I think that this model gives an hight level of abstraction and certainly gives the possibility to integrate a navigation module. For example it would be necessary a map in which each room is a waypoint stored in a new parameters file. Logically it would be also necessary a path planning algorithm and integrate also the obstacle avoidance module. Image below shows the arangement of rooms in the apartment that I have organized into a matrix. 
\item The robot is assumed to be a point (x,y). The movement is modeled as a wayting procedure. The robots move in a striaight line from the starting to the goal point with a constant speed 1 m/s. The wayting procedure is calculate according to that assuption. I have decided to use the action server because a durative action is a better choice than an instant one to model movement. This is particurlarlyimportant if the node needs to be integrated with a simulation. For this last reason I have decide to model the movement in the simpler possibile way giving anyway a feedback which is an important aspect to consider in a future implementation. Moreover an action can be stopped if needed, this allows the robot additional behaviour such as change the room when it is moving if called by a person.
\item The robot is considered inside a room when after the moving procedure it passes to the next state {\bfseries{Inside\+\_\+\+Room}} or {\bfseries{Oracle\+\_\+\+Room}} on the opposite side works when it exit from the room. The Corridor is considered out from any room. The robot when it enter in a room it simply announce where it actually is. Logically it is possible to store this information inside a variable. For example a bit array long as the number of room in which each cell is associated to a room and the value inside the cell is 1 if the robot is inside that specific room, 0 otherwise. This structure can be shared to the overall architecture through a publisher. I have decided to not implement that because I think at this level is useless. On the opposite side in the {\bfseries{\mbox{\hyperlink{_f_s_m_8py}{F\+S\+M.\+py}}}} is shared between different classes a variable which store the actual room and this is the starting point of that implementation.
\item The ontology provided by Professor is used to reason about hypotesis. H\+Y\+P\+O\+T\+E\+S\+IS is a class, an hypotesis is considered C\+O\+M\+P\+L\+E\+TE when it has at least three element, a complete hypotesisis is considered I\+N\+C\+O\+N\+S\+I\+S\+T\+E\+NT if there are at least two elements belonging to the same class. According to that an hypotesis is considered C\+O\+N\+S\+I\+S\+T\+E\+NT if it has one P\+E\+R\+S\+ON, one W\+E\+A\+P\+ON, one P\+L\+A\+CE. I have decided to add one class which is I\+N\+C\+O\+R\+R\+E\+CT. When the robot is inside the Oracle Room and understand that a consistent hypotesis is not correct it add it before removes it, then it add to the uncorrect class. In such a way if it perceives an hints beloging to an hypotesis that has been already checked as not correct it discard it. Logically this behaviour should be simply implemented with a list but this choice is used if in future implementation is needed to reason deeper on hypotesis.
\item The overall behaviour is based on the idea of randmness. The room where robot moves are chosen randomly. The hints are perceived or not randomly too, the possibility of not perceive an hint is always 1/4. Logically it is possible also to randomize this aspect. Moreover the hints are chosen randomly from the available parameters. A possible improvements about this aspect is to extract hints only once without the possibility of extract them again. This is possible using an array in which already extracted hints are selected. I have preferred play a bit with a\+R\+M\+OR adding a new class.
\item The announcement is simply a server that if called print the sentence on terminal. Logically in a real robot case the message should be published as text to speech message on robot microphone.
\item The Oracle is modeled as one a place where the robot goes and announce the hypotesis and check if correct. In a real case scenario this behaviour should be implemented as a waypoint in the map where the robot should go and where is located a person with which the robot should dialog.
\item A possible improvements is for example find differents way to perceive hints for example speak with someone or see something. The architecture should chose randomly between these possible behaviors.
\item The robot collect only one hint each time and then check if there is a consistent hypotesis. A simple modification should be collect a random number of hints and the check consistency. This is possible through a variable counter shared by {\bfseries{Out\+\_\+\+Room}} and {\bfseries{Inside\+\_\+\+Room}} state. I think the two options are more or less equivalent
\item {\bfseries{\mbox{\hyperlink{_random_room_server_8py}{Random\+Room\+Server.\+py}}}} at this level of implementation is useless. It can be easly replaced with a function on the {\bfseries{\mbox{\hyperlink{_f_s_m_8py}{F\+S\+M.\+py}}}}. I have decided to divide this module firsly because I think it has a specific purpose. Moreover in a future should be replace with a specific behaviour, for example if the robot decide the room to visit asking to someone. 
\end{DoxyEnumerate}